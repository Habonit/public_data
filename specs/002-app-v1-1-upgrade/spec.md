# Feature Specification: 대구 공공데이터 시각화 앱 v1.1 업그레이드

**Feature Branch**: `002-app-v1-1-upgrade`
**Created**: 2025-12-01
**Status**: Draft
**Input**: docs/v1.1/app_improvement_proposal.md 기반 앱 개선

## User Scenarios & Testing *(mandatory)*

### User Story 1 - CSV 파일 업로드 및 데이터 탐색 (Priority: P1)

데이터 분석 학습자로서, 내가 가진 CSV 파일을 직접 업로드하여 즉시 데이터를 탐색하고 시각화할 수 있어야 한다. 이를 통해 사전 정의된 데이터셋에 의존하지 않고 자유롭게 데이터를 분석할 수 있다.

**Why this priority**: 업로드 방식 전환은 전체 앱 구조 변경의 기반이다. 이 기능 없이는 다른 모든 개선 사항이 동작하지 않는다.

**Independent Test**: 앱을 실행하고 프로젝트 개요 탭에서 CSV 파일을 업로드한 후, 해당 데이터셋 탭에서 데이터 미리보기와 기본 통계가 표시되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 사용자가 앱을 처음 실행했을 때, **When** 프로젝트 개요 탭을 열면, **Then** 각 데이터셋별 업로드 영역이 표시된다
2. **Given** 사용자가 CCTV 데이터 업로드 영역에 CSV 파일을 업로드했을 때, **When** 업로드가 완료되면, **Then** 파일명과 파일 크기가 표시되고 CCTV 탭이 활성화된다
3. **Given** 사용자가 데이터를 업로드하지 않은 상태에서, **When** 시각화 탭에 접근하면, **Then** "데이터를 먼저 업로드해주세요" 안내 메시지가 표시된다
4. **Given** 사용자가 데이터를 업로드한 후, **When** 다른 UI 요소와 상호작용해도, **Then** 데이터가 다시 로딩되지 않고 즉시 반응한다

---

### User Story 2 - 다양한 시각화로 데이터 분석 (Priority: P2)

데이터 분석 학습자로서, 히스토그램 외에도 박스플롯, KDE, 산점도 등 다양한 차트를 선택하여 데이터 분포와 관계를 더 깊이 이해할 수 있어야 한다.

**Why this priority**: 시각화 다양화는 교육적 가치를 높이는 핵심 기능이지만, 업로드 기능이 먼저 구현되어야 한다.

**Independent Test**: 숫자형 컬럼이 있는 데이터셋을 업로드하고, 시각화 유형 선택 드롭다운에서 각 차트 유형을 선택하여 정상 렌더링되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 숫자형 컬럼이 있는 데이터셋이 업로드되었을 때, **When** 시각화 유형을 선택하면, **Then** 히스토그램, 박스플롯, KDE, 산점도 옵션이 표시된다
2. **Given** 사용자가 박스플롯을 선택했을 때, **When** 차트가 렌더링되면, **Then** 이상치와 사분위수가 시각적으로 구분되어 표시된다
3. **Given** 사용자가 산점도를 선택했을 때, **When** X축과 Y축 컬럼을 선택하면, **Then** 두 변수 간의 관계가 점으로 표시된다
4. **Given** 결측치가 30% 이상인 컬럼이 있을 때, **When** 해당 컬럼의 시각화를 시도하면, **Then** 경고 메시지가 표시된다

---

### User Story 3 - AI 챗봇으로 데이터 질의응답 (Priority: P3)

데이터 분석 학습자로서, 업로드한 데이터에 대해 자연어로 질문하고 AI로부터 답변을 받아 데이터 이해를 심화할 수 있어야 한다.

**Why this priority**: 챗봇은 새로운 기능으로, 핵심 기능(업로드, 시각화)이 먼저 안정화된 후 추가되어야 한다.

**Independent Test**: API Key를 입력하고 데이터셋을 선택한 후, "이 데이터의 주요 특징은?"이라고 질문하여 응답이 반환되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 사용자가 사이드바에서 API Key를 입력했을 때, **When** 데이터 질의응답 탭을 열면, **Then** 업로드된 데이터셋 목록이 선택 가능하게 표시된다
2. **Given** 사용자가 데이터셋을 선택하고 질문을 입력했을 때, **When** 전송 버튼을 누르면, **Then** AI가 해당 데이터 컨텍스트를 기반으로 답변한다
3. **Given** 대화가 진행 중일 때, **When** 사이드바를 확인하면, **Then** 전체 토큰, 입력 토큰, 출력 토큰 사용량이 표시된다
4. **Given** API Key가 입력되지 않은 상태에서, **When** 질문을 시도하면, **Then** API Key 입력을 요청하는 안내가 표시된다

---

### User Story 4 - 버그 없는 안정적인 앱 사용 (Priority: P0)

모든 사용자로서, 앱 사용 중 에러나 경고 없이 안정적으로 기능을 사용할 수 있어야 한다.

**Why this priority**: 버그 수정은 모든 기능의 기반이므로 가장 먼저 처리되어야 한다.

**Independent Test**: 빈 데이터셋, 숫자형 컬럼만 있는 데이터셋, 범주형 컬럼만 있는 데이터셋을 각각 업로드하여 에러 없이 처리되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 빈 DataFrame이 업로드되었을 때, **When** 통계 정보를 표시하려고 하면, **Then** 에러 대신 적절한 안내 메시지가 표시된다
2. **Given** 숫자형 컬럼이 없는 데이터셋일 때, **When** 숫자형 시각화 섹션에 접근하면, **Then** "숫자형 컬럼이 없습니다" 메시지가 표시된다
3. **Given** 컬럼이 하나도 없는 상태에서, **When** 평균 결측률을 계산하면, **Then** ZeroDivisionError 없이 0%로 표시된다

---

### Edge Cases

- 사용자가 CSV가 아닌 파일(예: xlsx, json)을 업로드하면 어떻게 되는가?
  → CSV 파일만 허용되며, 다른 형식은 업로드 거부 메시지 표시
- 업로드된 파일이 너무 클 경우(예: 100MB 이상) 어떻게 처리하는가?
  → 파일 크기 제한을 설정하고 초과 시 경고 메시지 표시
- 인코딩이 맞지 않는 CSV 파일이 업로드되면 어떻게 되는가?
  → UTF-8, UTF-8-SIG, CP949 순으로 시도 후 모두 실패 시 에러 메시지 표시
- API Key가 잘못된 경우 어떻게 처리하는가?
  → API 호출 실패 시 "API Key를 확인해주세요" 메시지 표시
- 네트워크 오류로 챗봇 응답이 없을 경우 어떻게 처리하는가?
  → 타임아웃 후 재시도 옵션과 함께 에러 메시지 표시

## Requirements *(mandatory)*

### Functional Requirements

#### 데이터 업로드 및 관리

- **FR-001**: 시스템은 프로젝트 개요 탭에서 각 데이터셋(CCTV, 보안등, 어린이보호구역, 주차장, 사고, 훈련, 테스트)별 업로드 영역을 제공해야 한다(MUST)
- **FR-002**: 시스템은 업로드된 CSV 파일의 이름과 크기를 표시해야 한다(MUST)
- **FR-003**: 시스템은 업로드된 데이터를 세션 동안 유지하여 재로딩을 방지해야 한다(MUST)
- **FR-004**: 시스템은 해당 데이터가 업로드된 경우에만 관련 탭을 활성화해야 한다(MUST)
- **FR-005**: 시스템은 데이터 미업로드 시 시각화 탭에서 업로드 안내 메시지를 표시해야 한다(MUST)

#### 시각화 기능

- **FR-006**: 시스템은 숫자형 컬럼에 대해 히스토그램, 박스플롯, KDE, 산점도 시각화를 제공해야 한다(MUST)
- **FR-007**: 시스템은 시각화 차트에 개선된 색상과 스타일을 적용해야 한다(MUST)
- **FR-008**: 시스템은 결측치 비율이 30% 이상인 컬럼에 대해 경고 알림을 표시해야 한다(MUST)
- **FR-009**: 시스템은 지도 시각화에서 명시적인 포인트 제한(5,000개)을 적용해야 한다(MUST)

#### 탭 구조

- **FR-010**: 시스템은 총 10개의 탭(프로젝트 개요, CCTV, 보안등, 어린이보호구역, 주차장, 사고, 훈련 데이터, 테스트 데이터, 교차 분석, 데이터 질의응답)을 제공해야 한다(MUST)
- **FR-011**: 시스템은 Train 탭을 "훈련 데이터", Test 탭을 "테스트 데이터"로 명칭을 수정해야 한다(MUST)
- **FR-012**: 시스템은 교차 데이터 분석에서 근접성 분석을 제거하고 통합 지도 시각화만 유지해야 한다(MUST)

#### 챗봇 기능

- **FR-013**: 시스템은 사이드바에서 API Key 입력 필드를 제공해야 한다(MUST)
- **FR-014**: 시스템은 사이드바에서 AI 모델 선택 드롭다운을 제공해야 한다(MUST)
- **FR-015**: 시스템은 데이터 질의응답 탭에서 업로드된 데이터셋을 선택할 수 있어야 한다(MUST)
- **FR-016**: 시스템은 선택된 데이터셋 컨텍스트를 기반으로 AI가 질문에 답변하도록 해야 한다(MUST)
- **FR-017**: 시스템은 사이드바에 전체/입력/출력 토큰 사용량을 표시해야 한다(MUST)

#### 버그 수정 및 안정성

- **FR-018**: 시스템은 빈 데이터셋에서 ZeroDivisionError가 발생하지 않도록 해야 한다(MUST)
- **FR-019**: 시스템은 deprecated API(width='stretch')를 현재 권장 API로 교체해야 한다(MUST)
- **FR-020**: 시스템은 숫자형/범주형 컬럼이 없는 경우 적절한 안내 메시지를 표시해야 한다(MUST)

### Key Entities

- **업로드된 데이터셋 (UploadedDataset)**: 사용자가 업로드한 CSV 파일. 파일명, 파일 크기, DataFrame, 업로드 시간을 포함한다.

- **시각화 설정 (VisualizationConfig)**: 차트 유형, 선택된 컬럼, 색상 테마 등 시각화 관련 설정을 포함한다.

- **챗봇 세션 (ChatSession)**: API Key, 선택된 모델, 대화 이력, 토큰 사용량을 포함한다.

- **사이드바 상태 (SidebarState)**: API 설정, 모델 선택, 토큰 현황, 데이터 업로드 현황을 포함한다.

### Assumptions

- 사용자는 기본적인 CSV 파일 구조를 이해하고 있다
- 업로드되는 CSV 파일은 일반적인 인코딩(UTF-8, UTF-8-SIG, CP949) 중 하나를 사용한다
- 사용자는 Anthropic API Key를 직접 발급받아 사용한다
- 로컬 환경에서만 실행되며, 배포는 고려하지 않는다
- 파일 업로드 크기 제한은 50MB로 설정한다 (Streamlit 기본값)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자가 CSV 파일을 업로드한 후 3초 이내에 데이터 미리보기가 표시된다
- **SC-002**: 업로드 후 탭 간 이동 및 UI 상호작용 시 추가 로딩 없이 즉시 반응한다
- **SC-003**: 4가지 이상의 차트 유형(히스토그램, 박스플롯, KDE, 산점도)을 선택하여 시각화할 수 있다
- **SC-004**: 결측치 30% 이상 컬럼에 대해 100% 경고 메시지가 표시된다
- **SC-005**: 챗봇 질문에 대해 10초 이내에 응답이 반환된다
- **SC-006**: 기존 코드의 모든 Warning/Error가 제거되어 콘솔에 경고가 출력되지 않는다
- **SC-007**: 빈 데이터셋, 특수 컬럼 구성 등 엣지 케이스에서 에러 없이 적절한 메시지가 표시된다
- **SC-008**: 사이드바에서 토큰 사용량이 실시간으로 업데이트된다
